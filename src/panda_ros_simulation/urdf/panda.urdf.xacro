<?xml version="1.0"?>
<robot name="franka_panda" xmlns:xacro="http://www.ros.org/wiki/xacro">

  <xacro:property name="mesh_pkg_visual" value="package://panda_ros_simulation/meshes/visual"/>
  <xacro:property name="mesh_pkg_collision" value="package://panda_ros_simulation/meshes/collision"/>
  <xacro:property name="mesh_pkg_description" value="package://panda_ros_simulation/urdf"/>

 
  <xacro:include filename="$(find panda_ros_simulation)/urdf/props.urdf.xacro"/>

  <material name="panda_gray"><color rgba="0.7 0.7 0.7 1"/></material>
  <material name="panda_dark"><color rgba="0.2 0.2 0.2 1"/></material>
  <material name="panda_white"><color rgba="0.95 0.95 0.95 1"/></material>

<xacro:macro name="panda_link" params="lname vmesh cmesh imesh color mass ixx iyy izz">
    <link name="${lname}">
      <visual>
        <geometry><mesh filename="${vmesh}" scale="1 1 1"/></geometry>
        <material name="${color}"/>
      </visual>
      <collision>
        <geometry><mesh filename="${cmesh}" scale="1 1 1"/></geometry>
      </collision>
      <xacro:panda_inertial mesh="${imesh}" mesh_offset_rpy="0 0 0"/>
    </link>
</xacro:macro>
 <link name="world"/>
  
  <link name="base_link"/>
  
  <joint name="world_to_base" type="fixed">
    <parent link="world"/>
    <child link="base_link"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
  </joint>

  <xacro:panda_link lname="panda_link0" vmesh="${mesh_pkg_visual}/link0.dae" cmesh="${mesh_pkg_collision}/link0.stl" imesh="${link0_mesh}" color="panda_dark" mass="1.0" ixx="0.01" iyy="0.01" izz="0.01"/>
  <xacro:panda_link lname="panda_link1" vmesh="${mesh_pkg_visual}/link1.dae" cmesh="${mesh_pkg_collision}/link1.stl" imesh="${link1_mesh}" color="panda_gray" mass="1.0" ixx="0.01" iyy="0.01" izz="0.01"/>
  <xacro:panda_link lname="panda_link2" vmesh="${mesh_pkg_visual}/link2.dae" cmesh="${mesh_pkg_collision}/link2.stl" imesh="${link2_mesh}"  color="panda_white" mass="1.0" ixx="0.01" iyy="0.01" izz="0.01"/>
  <xacro:panda_link lname="panda_link3" vmesh="${mesh_pkg_visual}/link3.dae" cmesh="${mesh_pkg_collision}/link3.stl" imesh="${link3_mesh}"  color="panda_gray" mass="1.0" ixx="0.01" iyy="0.01" izz="0.01"/>
  <xacro:panda_link lname="panda_link4" vmesh="${mesh_pkg_visual}/link4.dae" cmesh="${mesh_pkg_collision}/link4.stl" imesh="${link4_mesh}"  color="panda_white" mass="1.0" ixx="0.01" iyy="0.01" izz="0.01"/>
  <xacro:panda_link lname="panda_link5" vmesh="${mesh_pkg_visual}/link5.dae" cmesh="${mesh_pkg_collision}/link5.stl" imesh="${link5_mesh}"  color="panda_gray" mass="1.0" ixx="0.01" iyy="0.01" izz="0.01"/>
  <xacro:panda_link lname="panda_link6" vmesh="${mesh_pkg_visual}/link6.dae" cmesh="${mesh_pkg_collision}/link6.stl" imesh="${link6_mesh}"  color="panda_white" mass="0.8" ixx="0.008" iyy="0.008" izz="0.008"/>
  <xacro:panda_link lname="panda_link7" vmesh="${mesh_pkg_visual}/link7.dae" cmesh="${mesh_pkg_collision}/link7.stl" imesh="${link7_mesh}"  color="panda_dark" mass="0.6" ixx="0.006" iyy="0.006" izz="0.006"/>
  <xacro:panda_link lname="panda_hand" vmesh="${mesh_pkg_visual}/hand.dae" cmesh="${mesh_pkg_collision}/hand.stl" imesh="${hand_mesh}"   color="panda_dark" mass="0.2" ixx="0.002" iyy="0.002" izz="0.002"/>
  <xacro:panda_link lname="panda_leftfinger" vmesh="${mesh_pkg_visual}/finger.dae" cmesh="${mesh_pkg_collision}/finger.stl" imesh="${finger_mesh}"  color="panda_gray" mass="0.05" ixx="0.0005" iyy="0.0005" izz="0.0005"/>
  <xacro:panda_link lname="panda_rightfinger" vmesh="${mesh_pkg_visual}/finger.dae" cmesh="${mesh_pkg_collision}/finger.stl" imesh="${finger_mesh}"  color="panda_gray" mass="0.05" ixx="0.0005" iyy="0.0005" izz="0.0005"/>
  
  <link name="panda_link8"/>

  <joint name="base_to_panda_mount" type="fixed">
    <parent link="base_link"/>
    <child link="panda_link0"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
  </joint>

  <joint name="panda_joint1" type="revolute">
    <parent link="panda_link0"/>
    <child link="panda_link1"/>
    <origin xyz="0 0 0.33" rpy="0 0 0"/>
    <axis xyz="0 0 1"/>
    <limit lower="-2.8973" upper="2.8973" effort="87" velocity="2.175"/>
    <dynamics damping="1.0" friction="1.0"/>
  </joint>
  
  <joint name="panda_joint2" type="revolute">
    <parent link="panda_link1"/>
    <child link="panda_link2"/>
    <origin xyz="0 0 0" rpy="-1.5708 0 0"/>
    <axis xyz="0 0 1"/>
    <limit lower="-1.7628" upper="1.7628" effort="87" velocity="2.175"/>
    <dynamics damping="1.0" friction="1.0"/>
  </joint>
  
  <joint name="panda_joint3" type="revolute">
    <parent link="panda_link2"/>
    <child link="panda_link3"/>
    <origin xyz="0 -0.316 0" rpy="1.5708 0 0"/>
    <axis xyz="0 0 1"/>
    <limit lower="-2.8973" upper="2.8973" effort="87" velocity="2.175"/>
    <dynamics damping="1.0" friction="1.0"/>
  </joint>
  
  <joint name="panda_joint4" type="revolute">
    <parent link="panda_link3"/>
    <child link="panda_link4"/>
    <origin xyz="0.0825 0 0" rpy="1.5708 0 0"/>
    <axis xyz="0 0 1"/>
    <limit lower="-2.0718" upper="-0.0698" effort="87" velocity="2.175"/>
    <dynamics damping="1.0" friction="1.0"/>
  </joint>
  
  <joint name="panda_joint5" type="revolute">
    <parent link="panda_link4"/>
    <child link="panda_link5"/>
    <origin xyz="-0.0825 0.384 0" rpy="-1.5708 0 0"/>
    <axis xyz="0 0 1"/>
    <limit lower="-2.8973" upper="2.8973" effort="12" velocity="2.61"/>
    <dynamics damping="1.0" friction="1.0"/>
  </joint>
  
  <joint name="panda_joint6" type="revolute">
    <parent link="panda_link5"/>
    <child link="panda_link6"/>
    <origin xyz="0 0 0" rpy="1.5708 0 0"/>
    <axis xyz="0 0 1"/>
    <limit lower="-0.0175" upper="3.7525" effort="12" velocity="2.61"/>
    <dynamics damping="1.0" friction="1.0"/>
  </joint>
  
  <joint name="panda_joint7" type="revolute">
    <parent link="panda_link6"/>
    <child link="panda_link7"/>
    <origin xyz="0.088 0 0" rpy="1.5708 0 0"/>
    <axis xyz="0 0 1"/>
    <limit lower="-2.8973" upper="2.8973" effort="12" velocity="2.61"/>
    <dynamics damping="1.0" friction="1.0"/>
  </joint>

  <joint name="panda_joint8" type="fixed">
    <parent link="panda_link7"/>
    <child link="panda_link8"/>
    <origin xyz="0 0 0.107" rpy="0 0 0"/>
  </joint>

  <joint name="panda_hand_fixed_joint" type="fixed">
    <parent link="panda_link8"/>
    <child link="panda_hand"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
  </joint>

  <joint name="panda_finger_joint1" type="prismatic">
    <parent link="panda_hand"/>
    <child link="panda_leftfinger"/>
    <origin xyz="0.0 0.02 0.053" rpy="0 0 0"/>
    <axis xyz="0 -1 0"/>
    <limit lower="0.0" upper="0.035" effort="20" velocity="0.1"/>
  </joint>

  <joint name="panda_finger_joint2" type="prismatic">
    <parent link="panda_hand"/>
    <child link="panda_rightfinger"/>
    <origin xyz="0.0 -0.01 0.053" rpy="0 0 3.14159"/>
    <axis xyz="0 -1 0"/>
    <limit lower="0.0" upper="0.035" effort="20" velocity="0.1"/>
  </joint>

  <ros2_control name="PandaSystem" type="system">
    <hardware>
      <plugin>gazebo_ros2_control/GazeboSystem</plugin>
    </hardware>

    <joint name="panda_joint1"><command_interface name="position"/><command_interface name="velocity"/><state_interface name="position"/><state_interface name="velocity"/></joint>
    <joint name="panda_joint2"><command_interface name="position"/><command_interface name="velocity"/><state_interface name="position"/><state_interface name="velocity"/></joint>
    <joint name="panda_joint3"><command_interface name="position"/><command_interface name="velocity"/><state_interface name="position"/><state_interface name="velocity"/></joint>
    <joint name="panda_joint4"><command_interface name="position"/><command_interface name="velocity"/><state_interface name="position"/><state_interface name="velocity"/></joint>
    <joint name="panda_joint5"><command_interface name="position"/><command_interface name="velocity"/><state_interface name="position"/><state_interface name="velocity"/></joint>
    <joint name="panda_joint6"><command_interface name="position"/><command_interface name="velocity"/><state_interface name="position"/><state_interface name="velocity"/></joint>
    <joint name="panda_joint7"><command_interface name="position"/><command_interface name="velocity"/><state_interface name="position"/><state_interface name="velocity"/></joint>

    <joint name="panda_finger_joint1"><command_interface name="position"/><command_interface name="velocity"/><state_interface name="position"/><state_interface name="velocity"/></joint>
    <joint name="panda_finger_joint2"><command_interface name="position"/><command_interface name="velocity"/><state_interface name="position"/><state_interface name="velocity"/></joint>
  </ros2_control>

  <gazebo>
    <plugin filename="libgazebo_ros2_control.so" name="gazebo_ros2_control">
      <robot_param>robot_description</robot_param>
      <robot_param_node>robot_state_publisher</robot_param_node>
    </plugin>
  </gazebo>

</robot>